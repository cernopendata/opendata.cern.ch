{%- extends "invenio_records_ui/detail.html" %}

{% from 'cernopendata_records_ui/records/macros/files_box.html' import files_box %}

{%- block page_body %}
<div class="container">
  <div class="row">
    <div class="col-md-10">
      <div class="panel panel-default">
        <div class="panel-heading">
          {% block heading %}
          <h2 style="display: inline;">
            {{record.get('title', '')}}
            <small>{{record.get('date_published', '')}}</small>
          </h2>
          <div class="row">
            <div class="col-md-12">
              {{record.get('additional_title', '')}}
            </div>
            <div class="col-md-12">
              {% for author in record.get('authors', [])%}
              <small>{{author.get('name', '')}}</small>
              {% endfor %}
              <span class="label label-success">{{record.get('collaboration', '').get('name', '')}}</span>
              {% if record.get('year', '') %}
              <span class="label label-success">{{record.get('year')}} Run</span>
              {% endif %}
            </div>
          </div>
          <p></p>

          <div class="col-md-12">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">
                  <label>Cite as:</label>
                  {% for author in record.get('authors', []) %}
                  <span>{{author.get('name', '')}}.</span>
                  {% endfor %}
                  <span>{{record.get('collaboration', '').get('name', '')}} ({{record.get('date_published', '')}}). {{record.get('additional_title', '')}}. CERN Open Data Portal.
                                {% if record.get('doi', '') %}
                                  <label>DOI:</label>
                                  <a href="http://doi.org/{{record.get('doi', '')}}">{{record.get('doi', '')}}</a>
                                {% endif %}
                            </span>
                </h3>
              </div>
            </div>
          </div>
          <p></p>
          <div class="row">
            <div class="col-md-12">
              {% if record.get('collision_information', {}) %}
              <label>Collision Energy:</label>
              <span><a
                href="/search?q={{record.get('collision_information', {}).get('energy', '')}}">{{record.get('collision_information', {}).get('energy', '')}}</a></span>
              {% endif %}
              <label>Experiment:</label>
              <span><a href="/search?q={{record.get('experiment', '')}}">{{record.get('experiment', '')}}</a></span>
              <label>Accelerator:</label>
              <span><a href="/search?q={{record.get('accelerator', '')}}">{{record.get('accelerator', '')}}</a></span>
            </div>
          </div>
          {% endblock heading %}
        </div>
        <div class="panel-body">
          {% block metadata_block %}
          {% if record.get('abstract', '') %}
          <div class="row">
            <div class="col-md-12">
              <h3>Description</h3>
              <p>{{record.get('abstract', '')}}</p>
            </div>
          </div>
          {% endif %}
          {% endblock metadata_block %}

          {% include 'cernopendata_records_ui/records/components/previewer.html' %}

          {% block files_block %}
          {{ files_box(record) }}
          {% endblock files_block %}
          {% block disclaimer %}
          <div class="row">
            <div class="col-md-12">
              <h3>Disclaimer</h3>
              <p>The open data are released under the <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative
                Commons CC0 waiver</a>. Neither LHCb nor CERN endorse any
                works, scientific or otherwise, produced using these data.
                All releases will have a unique DOI that you are requested to cite in any applications or
                publications.
              </p>
              <img src="{{url_for('static', filename='img/cc-zero.svg')}}">
            </div>
          </div>
          {% endblock disclaimer %}
        </div>
      </div>
    </div>
    {% block export %}
    <div class="col-md-2">
      <div class="well">
        <h4> Export </h4>
        <ul class="list-inline">
          <li><a
            href="{{ url_for('invenio_records_ui.recid_export', pid_value=pid.pid_value, format='json') }}">JSON</a>
          </li>
        </ul>
      </div>
    </div>
    {% endblock export %}
  </div>
</div>
{%- endblock %}

{% block javascript %}
{{ super() }}

{% if record.get('files', []) %}
<script>
  $('#download_caution').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget)
    var file_uri = button.data('download-uri')
    var file_key = button.data('download-key')
    var file_size = button.data('download-size')

    var modal = $(this)
    modal.find('#download-msg-filename').text(file_key)
    modal.find('#download-msg-size').text(file_size)
    modal.find('#download-msg-uri').attr("href", file_uri)
  })
</script>
{% endif %}
{% endblock javascript %}

